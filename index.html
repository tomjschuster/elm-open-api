<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Quick App</title>
  <meta name="author" content="Tom Schuster">
  <meta name="description" content="Web App Code Generator">
  <meta name="keywords" content="code generation, sequelize, orm">
  </head>
  <body>
    <script src="elm.js"></script>
    <script>
      const app = Elm.Main.fullscreen()

      app.ports.export.subscribe(({ name, children }) =>
        createZip(new JSZip(), children)
          .generateAsync({ type: 'blob'})
          .then(blob => saveAs(blob, name))
      )

      function createZip (zip, children) {
        children.forEach(({ type, name, children, content }) => {
          if (type === 'directory') createZip(zip.folder(name), children)
          if (type === 'file') zip.file(name, content)
        })
        return zip
      }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js" async></script>
    <script src="https://fastcdn.org/FileSaver.js/1.1.20151003/FileSaver.min.js"></script>
  </body>
</html>  
